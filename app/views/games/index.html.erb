<h2>PlayStation4 ゲームタイトル一覧</h2>

<%= link_to '新規ゲームタイトル追加', new_game_path %>

<%= search_form_for @q do |form| %>
  <div class="search_field">
    <%= form.label :title_or_company, "Title or Company" %> : 
    <%= form.search_field :title_or_company_cont %>
  </div>

  <div class="search_field">
    <%= form.label :price %> : 
    <%= form.number_field :price_gteq, min: 0 %>以上〜
    <%= form.number_field :price_lt, min: 0, max: 100000 %>未満
  </div>

  <div class="search_field">
    <%= form.label :genre %> : 
    <label for="q_genre_in_1">action</label><input class="chkgroup" type="checkbox" value="1" name="q[genre_in][]" id="q_genre_in_1">
    <label for="q_genre_in_2">action RPG</label><input class="chkgroup" type="checkbox" value="2" name="q[genre_in][]" id="q_genre_in_2">
    <label for="q_genre_in_3">RPG</label><input class="chkgroup" type="checkbox" value="3" name="q[genre_in][]" id="q_genre_in_3">
    <label for="q_genre_in_4">adventure</label><input class="chkgroup" type="checkbox" value="4" name="q[genre_in][]" id="q_genre_in_4">
    <label for="q_genre_in_5">action_adventure</label><input class="chkgroup" type="checkbox" value="5" name="q[genre_in][]" id="q_genre_in_5">
    <label for="q_genre_in_6">shouting</label><input class="chkgroup" type="checkbox" value="6" name="q[genre_in][]" id="q_genre_in_6">
    <label for="q_genre_in_7">FPS/TPS</label><input class="chkgroup" type="checkbox" value="7" name="q[genre_in][]" id="q_genre_in_7">
    <label for="q_genre_in_8">pazzle</label><input class="chkgroup" type="checkbox" value="8" name="q[genre_in][]" id="q_genre_in_8">
    <label for="q_genre_in_9">simulation</label><input class="chkgroup" type="checkbox" value="9" name="q[genre_in][]" id="q_genre_in_9">
    <label for="q_genre_in_10">racing</label><input class="chkgroup" type="checkbox" value="10" name="q[genre_in][]" id="q_genre_in_10">
    <label for="q_genre_in_11">music</label><input class="chkgroup" type="checkbox" value="11" name="q[genre_in][]" id="q_genre_in_11">
    <label for="q_genre_in_12">battle</label><input class="chkgroup" type="checkbox" value="12" name="q[genre_in][]" id="q_genre_in_12">
    <label for="q_genre_in_13">sports</label><input class="chkgroup" type="checkbox" value="13" name="q[genre_in][]" id="q_genre_in_13">
    <label for="q_genre_in_14">others</label><input class="chkgroup" type="checkbox" value="14" name="q[genre_in][]" id="q_genre_in_14">
  </div>
  
  <div class="search_field">
    <%= form.label :releasd_at %> : 
    <%= form.date_field :released_at_gteq %>〜
    <%= form.date_field :released_at_lteq %>
  </div>

  <div class="action_field">
    <%= form.submit "検索" %>
  </div>

<% end %>


<table>
  <tr>
    <th>パッケージ画像</th>
    <th><%= sort_link(@q, :title, "タイトル名") %></th>
    <th><%= sort_link(@q, :company, "販売会社") %></th>
    <th><%= sort_link(@q, :released_at, "発売日", default_order: :desc) %></th>
    <th><%= sort_link(@q, :review_direction, "グラフィック・サウンド", default_order: :desc) %></th>
    <th><%= sort_link(@q, :review_operability, "操作性", default_order: :desc) %></th>
    <th><%= sort_link(@q, :review_story, "ストーリー・世界観", default_order: :desc) %></th>
    <th><%= sort_link(@q, :review_volume, "ボリューム・やりこみ要素", default_order: :desc) %></th>
    <th><%= sort_link(@q, :review_like, "ハマり度", default_order: :desc) %></th>
    <th><%= sort_link(@q, :review_all, "総合点", default_order: :desc) %></th>
  </tr>

<% @games.each do |game| %>
  <tr>
    <td><%= image_tag(game.icon.resize_for_game_icon.url) if game.icon && game.icon.url %></td>
    <td><%= game.title %></td>
    <td><%= game.company %></td>
    <td><%= game.released_at %></td>
    <td><%= game.reviews.sum(:direction) * 5 / game.reviews.count if game.reviews.present? %>点/100点</td>
    <td><%= game.reviews.sum(:operability) * 5 / game.reviews.count if game.reviews.present? %>点/100点</td>
    <td><%= game.reviews.sum(:story) * 5 / game.reviews.count if game.reviews.present? %>点/100点</td>
    <td><%= game.reviews.sum(:volume) * 5 / game.reviews.count if game.reviews.present? %>点/100点</td>
    <td><%= game.reviews.sum(:like) * 5 / game.reviews.count if game.reviews.present? %>点/100点</td>
    <td><%= game.reviews.sum(:direction) + game.reviews.sum(:operability) + game.reviews.sum(:story) + game.reviews.sum(:volume) + game.reviews.sum(:like) / game.reviews.count if game.reviews.present? %>点/100点</td>
    <td><%= link_to "詳細", game_path(game.id) %></td>
    <td><%= link_to "編集", edit_game_path(game.id) %></td>
    <td><%= link_to '削除', game_path(game.id), method: :delete ,data: { confirm: '本当に削除していいですか？' }%></td>
  </tr>
<% end %>
</table>

<%= paginate @games %>